<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - PizarraCollab</title>
    <link rel='stylesheet' href='css/style.css' />
    <link rel='stylesheet' href='css/profile.css' />
    <link rel='stylesheet' href='css/gallery.css' />
</head>
<body>
    <div class="profile-container">
        <div class="profile-header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">?</div>
                <div class="user-details">
                    <h1 id="username">Cargando...</h1>
                    <p id="userStats">Miembro desde <span id="memberSince">...</span></p>
                </div>
            </div>
            <div class="header-actions">
                <a href="index.html" class="btn btn-primary">üé® Ir a Dibujar</a>
                <a href="gallery.html" target="_blank" class="btn btn-secondary">üñºÔ∏è Galer√≠a Global</a>
                <button class="btn btn-danger" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>
        </div>

        <!-- Session Management Section -->
        <div class="sessions-management-section">
            <div class="section-header">
                <h2>üé® Mis Sesiones</h2>
                <button class="btn btn-primary" onclick="openCreateSessionModal()">+ Crear Nueva Sesi√≥n</button>
            </div>
            <div id="mySessionsContainer" class="sessions-grid">
                <p class="loading">Cargando sesiones...</p>
            </div>
        </div>

        <div class="gallery-section">
            <div class="gallery-header">
                <h2>Mis Dibujos (<span id="imageCount">0</span>)</h2>
            </div>
            <div id="galleryContent" class="loading">
                Cargando galer√≠a...
            </div>
        </div>
    </div>

    <!-- Modal para crear/editar sesi√≥n -->
    <div id="sessionModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSessionModal()">√ó</button>
            <h2 id="sessionModalTitle">Crear Nueva Sesi√≥n</h2>
            
            <form id="sessionForm" onsubmit="saveSession(event)">
                <div class="form-group">
                    <label for="sessionIdInput">ID de Sesi√≥n:</label>
                    <input type="text" id="sessionIdInput" required readonly style="background: #f5f5f5; cursor: not-allowed;">
                    <small>ID √∫nico generado autom√°ticamente (15 d√≠gitos)</small>
                </div>

                <div class="form-group">
                    <label for="sessionName">Nombre de la Sesi√≥n:</label>
                    <input type="text" id="sessionName" required placeholder="Ej: Sesi√≥n de Arte Colaborativo">
                </div>

                <div class="form-group">
                    <label for="sessionDescription">Descripci√≥n:</label>
                    <textarea id="sessionDescription" rows="3" placeholder="Describe tu sesi√≥n..."></textarea>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="sessionIsPublic" checked>
                        <span>Sesi√≥n P√∫blica</span>
                    </label>
                    <small>Las sesiones p√∫blicas aparecen en la galer√≠a. Las privadas solo en el panel de administraci√≥n.</small>
                </div>

                <div class="form-group">
                    <label>‚öôÔ∏è Configuraci√≥n de Acceso y Herramientas:</label>
                    <small style="display: block; margin-bottom: 15px;">Configura qu√© herramientas puede usar cada tipo de usuario</small>
                    
                    <!-- Usuarios NO Registrados -->
                    <div class="access-config-section" data-user-type="notLogged">
                        <div class="access-config-header">
                            <label class="checkbox-label">
                                <input type="checkbox" id="allowNotLogged" class="user-type-toggle" data-user-type="notLogged" checked>
                                <span><strong>üë§ Usuarios NO Registrados</strong></span>
                            </label>
                        </div>
                        <div class="user-config-content">
                            <div id="notLoggedBrushes" class="brush-types-grid" style="margin-top: 10px;">
                                <!-- Se llenar√° din√°micamente con brushes + restricciones -->
                            </div>
                        </div>
                    </div>

                    <!-- Usuarios Registrados -->
                    <div class="access-config-section" data-user-type="logged">
                        <div class="access-config-header">
                            <label class="checkbox-label">
                                <input type="checkbox" id="allowLogged" class="user-type-toggle" data-user-type="logged" checked>
                                <span><strong>üîê Usuarios Registrados</strong></span>
                            </label>
                        </div>
                        <div class="user-config-content">
                            <div id="loggedBrushes" class="brush-types-grid" style="margin-top: 10px;">
                                <!-- Se llenar√° din√°micamente con brushes + restricciones -->
                            </div>
                        </div>
                    </div>

                    <!-- Usuarios Espec√≠ficos -->
                    <div class="access-config-section" data-user-type="specific">
                        <div class="access-config-header">
                            <label class="checkbox-label">
                                <input type="checkbox" id="allowSpecific" class="user-type-toggle" data-user-type="specific">
                                <span><strong>üë• Usuarios Espec√≠ficos</strong></span>
                            </label>
                        </div>
                        <div id="specificUsersConfig" class="user-config-content" style="display: none; margin-top: 10px;">
                            <input type="text" id="specificUsers" class="jpinput" placeholder="usuario1, usuario2, usuario3" style="width: 100%; margin-bottom: 10px;">
                            <small style="display: block; margin-bottom: 10px;">Separa los nombres de usuario con comas</small>
                            <div id="specificBrushes" class="brush-types-grid">
                                <!-- Se llenar√° din√°micamente con brushes + restricciones -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personalizaci√≥n Visual -->
                <div class="form-group">
                    <label>üé® Personalizaci√≥n Visual:</label>
                    <small style="display: block; margin-bottom: 15px; color: #999;">Personaliza c√≥mo se ve la galer√≠a y la interfaz de dibujo de esta sesi√≥n</small>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="backgroundImageInput" style="font-weight: 600;">Imagen de Fondo:</label>
                        <input type="file" id="backgroundImageInput" accept="image/*" style="display: block; margin-top: 5px;">
                        <small style="color: #999;">Esta imagen aparecer√° como fondo en la galer√≠a de la sesi√≥n</small>
                        <div id="backgroundImagePreview" style="margin-top: 10px; display: none;">
                            <img id="previewImg" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #667eea;">
                            <button type="button" onclick="removeBackgroundImage()" class="btn btn-danger btn-small" style="margin-top: 5px;">Eliminar Imagen</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="logoImageInput" style="font-weight: 600;">Logo de la Sesi√≥n:</label>
                        <input type="file" id="logoImageInput" accept="image/*" style="display: block; margin-top: 5px;">
                        <small style="color: #999;">Este logo aparecer√° en el header de la galer√≠a</small>
                        <div id="logoImagePreview" style="margin-top: 10px; display: none;">
                            <img id="logoPreviewImg" style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 2px solid #667eea;">
                            <button type="button" onclick="removeLogoImage()" class="btn btn-danger btn-small" style="margin-top: 5px;">Eliminar Logo</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <input type="checkbox" id="useCustomColors" style="width: 20px; height: 20px; cursor: pointer;">
                            <label for="useCustomColors" style="font-weight: 600; cursor: pointer; margin: 0;">Usar Colores Personalizados</label>
                        </div>
                        
                        <div id="customColorsContainer" style="opacity: 0.5; pointer-events: none; transition: all 0.3s ease;">
                            <label style="font-weight: 600; display: block; margin-bottom: 10px;">Colores de la Interfaz:</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <label for="colorBackground" style="display: block; margin-bottom: 5px;">üé® Fondo:</label>
                                    <input type="color" id="colorBackground" value="#1a1a2e" style="width: 100%; height: 40px; border-radius: 8px; border: 2px solid #667eea; cursor: pointer;">
                                </div>
                                <div>
                                    <label for="colorPrimary" style="display: block; margin-bottom: 5px;">‚ú® Color Primario:</label>
                                    <input type="color" id="colorPrimary" value="#667eea" style="width: 100%; height: 40px; border-radius: 8px; border: 2px solid #667eea; cursor: pointer;">
                                </div>
                                <div>
                                    <label for="colorSecondary" style="display: block; margin-bottom: 5px;">üåü Color Secundario:</label>
                                    <input type="color" id="colorSecondary" value="#764ba2" style="width: 100%; height: 40px; border-radius: 8px; border: 2px solid #667eea; cursor: pointer;">
                                </div>
                                <div>
                                    <label for="colorText" style="display: block; margin-bottom: 5px;">üìù Tipograf√≠a:</label>
                                    <input type="color" id="colorText" value="#ffffff" style="width: 100%; height: 40px; border-radius: 8px; border: 2px solid #667eea; cursor: pointer;">
                                </div>
                            </div>
                            <small style="color: #999; display: block; margin-top: 10px;">Estos colores se aplicar√°n en la galer√≠a y en la interfaz de dibujo</small>
                        </div>
                    </div>
                </div>

                <!-- Configuraci√≥n de Capas Iniciales -->
                <div class="form-group">
                    <label>üé® Capas Iniciales:</label>
                    <small style="display: block; margin-bottom: 15px; color: #999;">Configura con cu√°ntas capas empezar√° la sesi√≥n y qu√© imagen tendr√° cada una</small>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="layerCount" style="font-weight: 600; display: block; margin-bottom: 5px;">N√∫mero de capas:</label>
                        <input type="number" id="layerCount" min="1" max="10" value="1" style="width: 100px; padding: 8px; border: 2px solid #667eea; border-radius: 5px;" onchange="generateLayerConfiguration()">
                        <small style="color: #999; margin-left: 10px;">M√°ximo 10 capas</small>
                    </div>
                    
                    <div id="layersConfiguration" style="border: 2px solid #667eea; border-radius: 10px; padding: 15px; background: rgba(102, 126, 234, 0.05);">
                        <!-- Las configuraciones de capas se generar√°n din√°micamente aqu√≠ -->
                    </div>
                </div>

                <!-- Configuraci√≥n de Im√°genes por Defecto para Brush de Imagen -->
                <div class="form-group">
                    <label>üñºÔ∏è Im√°genes por Defecto para Brush de Imagen:</label>
                    <small style="display: block; margin-bottom: 15px; color: #999;">Configura im√°genes que estar√°n disponibles por defecto en el brush de imagen de esta sesi√≥n</small>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="enableDefaultImages" style="transform: scale(1.2);">
                            <span style="font-weight: 600;">Habilitar im√°genes por defecto</span>
                        </label>
                    </div>
                    
                    <div id="defaultImagesContainer" style="border: 2px solid #667eea; border-radius: 10px; padding: 15px; background: rgba(102, 126, 234, 0.05); display: none;">
                        <div style="margin-bottom: 15px;">
                            <button type="button" onclick="addDefaultImage()" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                ‚ûï Agregar Imagen
                            </button>
                        </div>
                        <div id="defaultImagesList">
                            <!-- Las im√°genes por defecto se generar√°n din√°micamente aqu√≠ -->
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSessionModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Sesi√≥n</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para ver imagen completa con todos los datos -->
    <div id="imageModal" class="modal">
        <div class="modal-content-large">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="modal-layout">
                <div class="modal-image-container">
                    <img id="modalImage" class="modal-image" src="" alt="Imagen">
                    
                    <!-- Selector de capas -->
                    <div id="layersSelector" class="layers-selector" style="display: none;">
                        <h4>üé® Ver por capas:</h4>
                        <div id="layerButtons" class="layer-buttons"></div>
                        <button id="downloadLayersBtn" class="btn btn-primary btn-small" onclick="downloadLayers()" style="margin-top: 10px; width: 100%;">
                            üì¶ Descargar capas (ZIP)
                        </button>
                    </div>
                </div>
                <div class="modal-sidebar">
                    <div class="modal-header">
                        <h3 id="modalTitle">T√≠tulo</h3>
                        <p id="modalDescription" class="modal-description"></p>
                    </div>
                    
                    <div class="modal-meta">
                        <p id="modalAuthor" class="author-info">üë§ Por: <strong>Usuario</strong></p>
                        <p id="modalSavedBy" class="saved-by-info">üíæ Guardado por: <strong>Usuario</strong></p>
                        <p id="modalDate" class="date-info">üìÖ Fecha</p>
                        <p id="modalSession" class="session-info">üé® Sesi√≥n: <strong>0</strong></p>
                    </div>

                    <div id="collaboratorsSection" class="collaborators-section">
                        <h4>üë• Colaboradores</h4>
                        <div id="modalCollaborators"></div>
                    </div>

                    <div class="like-section">
                        <button id="likeBtn" class="like-btn" onclick="toggleLike()">
                            <svg id="likeIcon" viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/>
                            </svg>
                            <span id="likeText">Me gusta</span>
                        </button>
                        <p id="likesCount" class="likes-count">0 likes</p>
                    </div>

                    <div class="comments-section">
                        <h4>üí¨ Comentarios (<span id="commentsCount">0</span>)</h4>
                        
                        <div id="commentForm" class="comment-form">
                            <textarea id="commentInput" placeholder="Escribe un comentario..." rows="3" maxlength="500"></textarea>
                            <button onclick="submitComment()" class="btn btn-primary btn-small">Comentar</button>
                        </div>

                        <div id="commentsList" class="comments-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script src="js/config.js"></script>
    <script src="js/index/toast.js"></script>
    
    <!-- Cargar BrushRegistry para obtener nombres din√°micamente -->
    <script src="js/index/brushes/BaseBrush.js"></script>
    <script src="js/index/brushes/BrushRegistry.js"></script>
    <script src="js/index/brushes/standardbrush.js"></script>
    <script src="js/index/brushes/artbrush.js"></script>
    <script src="js/index/brushes/pixelbrush.js"></script>
    <script src="js/index/brushes/linebrush.js"></script>
    <script src="js/index/brushes/geometrybrush.js"></script>
    <script src="js/index/brushes/flowerbrush.js"></script>
    <script src="js/index/brushes/fillbrush.js"></script>
    <script src="js/index/brushes/imagebrush.js"></script>
    <script src="js/index/brushes/textbrush.js"></script>
    
    <script src="js/profile/profile.js"></script>
</body>
</html>
